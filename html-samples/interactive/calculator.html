<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Introdu√ß√£o a Frontend</title>
    <link rel="stylesheet" href="../../css/global.css">
    <link rel="stylesheet" href="../../css/calculator.css">
  </head>
  <body>
    <header>
      <a href="javascript:history.back()">üëà Voltar</a>
      <h1>Introdu√ß√£o a Frontend</h1>
    </header>

    <section>
      <h3>Calculadora (Desafio)</h3>

      <div class="calculator">
        <table>
          <tbody>
            <tr><td colspan="4" tabindex="0" id="result"></td></tr>
            <tr>
              <td><button id="AC" class="special-button">AC</button></td>
              <td><button id="DEL" class="special-button">DEL</button></td>
              <td><button id="inverse" class="special-button">+/-</button></td>
              <td><button id="division" class="operator-button">/</button></td>
            </tr>
            <tr>
              <td><button class="number-button">7</button></td>
              <td><button class="number-button">8</button></td>
              <td><button class="number-button">9</button></td>
              <td><button id="multiplication" class="operator-button">x</button></td>
            </tr>
            <tr>
              <td><button class="number-button">4</button></td>
              <td><button class="number-button">5</button></td>
              <td><button class="number-button">6</button></td>
              <td><button id="subtraction" class="operator-button">-</button></td>
            </tr>
            <tr>
              <td><button class="number-button">3</button></td>
              <td><button class="number-button">2</button></td>
              <td><button class="number-button">1</button></td>
              <td><button id="addition" class="operator-button">+</button></td>
            </tr>
            <tr>
              <td><button class="number-button">0</button></td>
              <td><button id="dot">.</button></td>
              <td colspan="2"><button id="equals" class="equals-button operator-button">=</button></td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section class="checklist" style="margin-top: 20px;">
      <details>
        <summary>Checklist do desafio</summary>
        <ul>
          <li>Implementar fun√ß√£o de adi√ß√£o &#10004;</li>
          <li>Implementar fun√ß√£o de subtra√ß√£o &#10004;</li>
          <li>Implementar fun√ß√£o de multiplica√ß√£o &#10004;</li>
          <li>Implementar fun√ß√£o de divis√£o &#10004;</li>
          <li>O ponto (".") s√≥ pode ser usado 1 vez </li>
          <li>O visor tem que se manter atualizado, ou seja, clicar em algum bot√£o, ele mudar√° &#10004;</li>
          <li>Algumas calculadoras v√£o mostrando as opera√ß√µes, como no Windows ou site do Google. Isso √© opcional</li>
        </ul>
      </details>
    </section>
    <script>
      const resultElement = document.querySelector('#result')
      const numbers = document.querySelectorAll('.number-button')
      const clearButton = document.querySelector('#AC')
      const deleteButton = document.querySelector('#DEL')
      const inverseButton = document.querySelector('#inverse')
      const dotButton = document.querySelector('#dot')
      const additionButton = document.querySelector('#addition')
      const subtractionButton = document.querySelector('#subtraction')
      const multiplicationButton = document.querySelector('#multiplication')
      const divisionButton = document.querySelector('#division')
      const equalsButton = document.querySelector('#equals')
      let previousValue = parseInt(resultElement.textContent)
      
      clearButton.addEventListener('click', ()=>{
        resultElement.textContent = ''
      })

      deleteButton.addEventListener('click', ()=>{
        resultElement.textContent = resultElement.textContent.slice(0,-1);
      })
      inverseButton.addEventListener('click', ()=>{
        resultElement.textContent.charAt(resultElement.textContent.length-1) == '' ? '' :
          resultElement.textContent = eval(`(${resultElement.textContent})*-1`)
      })
      numbers.forEach(item =>{
        item.addEventListener('click', ()=>{
        resultElement.textContent = resultElement.textContent.concat(item.innerText)
        })
      })

      resultElement.addEventListener('keyup', function (event) {
        let allowedKeys = ['0','1','2','3','4','5','6','7','8','9']
        let operatorKeys = ['+','-','*','/','.']
        console.log(event.key)
        if(allowedKeys.includes(event.key))
          resultElement.textContent = resultElement.textContent.concat(event.key)

        if(operatorKeys.includes(event.key) && resultElement.textContent.charAt(resultElement.textContent.length-1) !== event.key)
          resultElement.textContent = resultElement.textContent.concat(event.key)
      })
      additionButton.addEventListener('click', () => {
        resultElement.textContent.charAt(resultElement.textContent.length-1) == '+' ? '' : 
          resultElement.textContent = resultElement.textContent.concat('+')
        
      })
      subtractionButton.addEventListener('click', () => {
        resultElement.textContent.charAt(resultElement.textContent.length-1) == '-' ? '' : 
          resultElement.textContent = resultElement.textContent.concat('-')
      })

      multiplicationButton.addEventListener('click', () => {
        let result = resultElement.textContent.charAt(resultElement.textContent.length-1)

        result == '/' || result == '*' || result == '+' || result == '-'  || result == '' ? '' : 
          resultElement.textContent = resultElement.textContent.concat('*')
      })

      divisionButton.addEventListener('click', () => {
        let result = resultElement.textContent.charAt(resultElement.textContent.length-1)

        result == '/' || result == '*' || result == '+' || result == '-'  || result == '' ? '' : 
          resultElement.textContent = resultElement.textContent.concat('/')
      })
      dotButton.addEventListener('click', () => {
        let result = resultElement.textContent.charAt(resultElement.textContent.length-1)

        result == '.' || /.\d/.test(resultElement.textContent) ?  '' : 
          resultElement.textContent = resultElement.textContent.concat('.')
      })
      equalsButton.addEventListener('click', () => {
        resultElement.textContent = eval(resultElement.textContent)
      })

    </script>
  </body>
</html>
